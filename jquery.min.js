
// <![CDATA[
  $(function(){

	//InitTipsy();  	
    	
    	//var doc_root = location.protocol + '//' + location.host + '/';
    	
    	var directory = "/myminelink/";
    	var doc_root = "http://"+location.host+directory;
    	var video_link_url;
    	
    	
    	
    	/* Update periodically  
		----------------------*/
		//1. step 1 
		//2. step 2		
		/* post - InitPost
		-------------poster and commentist username tooltip*/	
		//1. /* wrap corner show */
		//2./* preview image*/
		/* modal -basic - InitModal
		-------------*/	
		/* modal - Edit mine it - InitEdit
		-------------*/	
		/* Modal - Add - InitAdd
		-------------*/
		/* Modal - addSelect - InitaddSelect
		-------------*/
		/* Modal - login - Initlogin
		-------------*/
		/* modal - list  - InitList
		-------------*/															
		/* modal - share  - InitShare
		-------------*/				
		/* infinite scroll - InitInfiniteScroll
		-------------*/		
  	

		
		
		
		
		
		function InitTipsy() {		
			/* tipsy - InitTipsy
			-------------poster and commentist username tooltip*/
			$('.postusername').tipsy({gravity: 'w'});  
			$('.commentistname').tipsy({gravity: 'w'});
		}		
		
		
		  	
  	
  	
  	
  	
  	
  	
  	
  
  	
  	








/*For id selectors, jQuery uses the JavaScript function document.getElementById(), 
* which is extremely efficient.
* Calling jQuery() (or $()) with an id selector as its argument will return a jQuery object 
* containing a collection of either zero or one DOM element.
*/
/*
*  Perform an asynchronous HTTP (Ajax) request.
*   $ 相當於 jQuery
*   success 則是 Ajax 成功時呼叫的 callback。
*   error 是定義當 Ajax 發生錯誤時會呼叫的 callback
*   這個參數預設是以 HTML 的資料格式來看待，以上述的例子而言，在沒有指定回傳資料型態的情況下，response 預期會是一份 HTML 資料，
*   所以可以直接利用 jQuery 的 html 函式來塞入 HTML 資料。
    但是如果 server 端程式的回應值不是 HTML 的時候呢？
    要怎麼改變 response 的資料型態？
    答案就是在 $.ajax 函式中加入 dataType 的參數來指定。
$.ajax({
  type: "GET",
  url: "test.js",
  dataType: "script"
});

$.ajax({
  dataType: "json",
  url: url,
  data: data,
  success: success
});

$.getJSON( "ajax/test.json", function( data ) {
  var items = [];
  $.each( data, function( key, val ) {
    items.push( "<li id='" + key + "'>" + val + "</li>" );
  });
 
  $( "<ul/>", {
    "class": "my-new-list",
    html: items.join( "" )
  }).appendTo( "body" );
});
This example, of course, relies on the structure of the JSON file:

1
2
3
4
5
{
  "one": "Singular sensation",
  "two": "Beady little eyes",
  "three": "Little birds pitch by my doorstep"
}
            var posts = $('.posts'), arr = new Array;
            $.getJSON('http://twitter.com/status/user_timeline/'+user+'.json?count=5&callback=?', function(data) {
                $.each(data, function(i, post){
                    arr.push('<div class="post">');
                    arr.push(post.text);
                    arr.push('</div>');
                });
                var html = arr.join('');
                posts.html(html).fadeIn();
            });

*/
/**/
    	/* Update periodically
		----------------------*/
		setInterval(function()
		{   			
    		if (local_id != 0 && $.trim(local_id).length != 0) {
	    									  
				var ID3399= $("#latest_item_id").val();
				
				if (ID3399) {
 					$.ajax({
						type: "POST",
						url: "load_messages_test_worldwide.php",		
						data: "latest_item_id="+ID3399+'&from_periodical_update='+1, 
						cache: false,
						success: function(respond){
							if (parseInt(respond.match(/[0-9.]+/g))>0) {
								$("#latest_item_id_click").val(ID3399);	
								$('.new-content').find('span').html(respond);
								$('.new-content').fadeIn('slow');
							}      
    				    	return false;
						}
					});
				}				
			} 		  		
		},180000); 	
		
		
		
		
		
		
		
		
		
		
		$("#new-content").live('click',function()
		{    		
    		var s= $("#latest_item_id_click").val();
    		$('.new-content').find('span').html("<img src='https://s3-ap-northeast-1.amazonaws.com/cdn2.myminelink.com/loading.gif'/>");
 			$.ajax({
				type: "POST",
				url: "load_messages_test_worldwide.php",		
				data: "latest_item_id="+s, 
				cache: false,
				success: function(html_prepend){
	

				$('.new-content').slideUp(10);
				$('.new-content').find('span').html("");				
				$("#latest_item_id").remove();
				setTimeout(function(){
					var $container = $('#container');
  			  		var $newEls_prepend = $( html_prepend );
    		    	$container.prepend( $newEls_prepend ).isotope('reloadItems').isotope({ sortBy: 'original-order' });
					setTimeout(function(){ 
						$container.isotope('reLayout');
					},1000);
				},50);        
    		    return false;
				}
			}); 
		}); 			
		
		
		
		
		
		
		
	
		

		




		/* post - InitPost
		-------------poster and commentist username tooltip*/				  	
  		/* wrap corner show */
 		$('.photo').live({
			mouseenter:
			function()
			{
			var parentId = $(this).attr('id');	
			var s = 0;
			if(parentId){
				s = parseInt(parentId.match(/[0-9.]+/g));
			}				
				$("#readed_box"+s).fadeIn('fast');									    															
			},	
			mouseleave:
			function(){
			var parentId = $(this).attr('id');	
			var s = 0;
			if(parentId){
				s = parseInt(parentId.match(/[0-9.]+/g));
			}				
				$("#readed_box"+s).fadeOut('fast');	
			}
		});


				

        


	
	
	
	
	
		/* Preview image or Not */
		var running = 0;
		var flag_preview = 1;
				
		/* preview image
		-------------*/	
		//$('.photo .ImgLink-photo sup').live({
		$('.photo .ImgLink-photo img').live({
			mouseenter:
			function()
			{		
				var s = $(this).parent().find('.current_load_post_cover').attr('data-id');							
				var pos =$('#item'+s).position();		
				//$('#item'+s).addClass('scaleItem');			
				var gmiW = $(this).parent().find('.current_load_post_cover').width();
				var gmiH = $(this).parent().find('.current_load_post_cover').height();
				var niwW = $(window).width();
				var niwH = $(window).height();	
				var esuomW = event.pageX;
				var esuomH = event.pageY;		
				var ratioW = Math.floor( ( $(window).width() )/gmiW );
				var ratioH = Math.floor( ( $(window).height() )/gmiH );
				if (ratioW > ratioH) {
					ratioW = ratioH;
				}
				else {
					ratioH = ratioW;					
				}
				if (ratioH > 1) {
					ratioW = 2;//ratioW+1;
					ratioH = 2;//ratioH+1;
				}
				else {
					ratioW = ratioW+1;
					ratioH = ratioH+1;					
				}		
				var prevw = gmiW*ratioW;
				var prevh = gmiH*ratioW;
				$('#photo-comp-thumb').css({width: prevw, height: prevh});
				var paddingemarf = 14; 
				$('#photo-details-container').css({width: prevw+paddingemarf , height: prevh+paddingemarf });
				$('#photo-comp-thumb').attr("src",'worldwide/images/ajax-loader-preview.gif'); 
				$('div #photo-details-container').show();			
									   
				$parent = $(this).parent().find('.current_load_post_cover');															
				var imgsrcORI = $parent.attr('name');
				
				var tPosY = pos.top-(gmiH/2);
				if (tPosY < 0) {
							tPosY = 0 ;
				}						
				var tPosX = pos.left+278;
				if ((tPosX + prevw) > $(window).width()) {
		  			  	   	tPosX = pos.left-prevw-paddingemarf-23;
		    	}
				$('div #photo-details-container').css({position: 'absolute', zIndex: 100000});									
				$('div #photo-details-container').css({top: tPosY, left: tPosX});
				$('#photo-comp-thumb').attr("src",imgsrcORI); 
				$('div #photo-details-container').show();								    															
			},	
			mouseleave:
			function(){
				$(this).parent().find('.current_load_post_cover').find('img').css({ opacity: 0.4 });					
				$('div #photo-details-container').hide();					
			}
		});				
		
		
		

			
			
			
			

	


		
		/* modal -basic - InitModal
		-------------*/	
		function loadPopup(popupContact)
		{
			//$(".backgroundPopup").css({"opacity": "0.1"});
			if (popupContact!=".modal-add" && popupContact!=".modal-list" && popupContact!=".modal-share" && popupContact!=".modal-upload") {
				$("body").css("overflow", "hidden");
			}
			if (popupContact==".modal-list" || popupContact==".modal-add" || popupContact==".modal-share" || popupContact==".modal-upload") {
				$("body").css("overflow", "auto");
			}							
			$(".backgroundPopup").fadeIn("fast");
			//$(popupContact).slideDown(300);
			//$(popupContact).effect("shake", {times:0}, 100);			
			$(popupContact).fadeIn(10);
			pause_load_more = true;
		}
		function disablePopup(popupContact)
		{
			$(".backgroundPopup").fadeOut("slow");
			//$(popupContact).slideUp("slow");
			$(popupContact).fadeOut(50);
							$("body").css("overflow", "auto");

			if ($('#pin_ajax_view').css('display')=="none") {

				$("body").css("overflow", "auto");
			}
			pause_load_more = false;			
		}
		function centerPopup(popupContact)
		{
			var windowWidth = document.documentElement.clientWidth;
			var windowHeight = document.documentElement.clientHeight;
			var popupHeight = $(popupContact).height();
			var popupWidth = $(popupContact).width();
			$(popupContact).css({"position": "absolute","top": windowHeight/2-popupHeight/2,"left": windowWidth/2-popupWidth/2});
			$(".backgroundPopup").css({"height": windowHeight});
		}		
				

		/* board list(select option) show or hide */
		$('.current').live("click",function() 
		{
			$('.BoardList').toggle();
		});		
		$(".wrapper ul li").live("click",function()
		{ 
		    var text = $(this).children("span").html();
		    $(".CurrentBoard").html(text);
		    $(".BoardList").hide();
		});	
		
		$(document).bind('click', function(e) {
		    var $clicked = $(e.target);
		    //alert($clicked.parents().attr('class')); avoid this 
		    if (! $clicked.parents().hasClass("BoardSelector BoardPicker")){
		    	$(".BoardList").hide();
			}
		});	

		/* link privacy on/off */
		$('.type_1JS').switches({ type: 'circle' });	
		
		
		
		
				
	
		




		/* Modal - Upload - InitUpload
		-------------*/
		$(".uploadMineIt").live('click',function()
		{
			//centerPopup(".modal-add");
			//$('.modal-addSelect').fadeOut(10);
			loadPopup(".modal-upload");
		});			

		$('.cancel_upload_mine_it').live("click",function() 
		{
			$('.switch-trigger').removeClass('on'); 
			$('.switch-trigger').addClass('off');
			$('.type_1JS').removeAttr('checked'); 	
			$('.create_upload_description').val('');	
		    $(".BoardList").hide();			
		    $('#url1').val('') ;
		    $('#url2').val('') ;
		    $('.images-upload').html('');
		    $('.info-upload').html('');
		    $("#modal-upload-content").hide();  	
			disablePopup(".modal-upload");							 			
		});
		
		$uploadTabs = $(".tabsJS");
		$uploadTab = $uploadTabs.find("a");
		//$uploadTabName = $uploadTabs.find("a").attr('href'); 
		$uploadTab.live('click',function()
		{
			var uploadTabName = $(this).attr('data-id');	
						if (uploadTabName=="Facebook-tab") {

				        loadFbTab();
			}	
			uploadTabName = "#"+uploadTabName;
			//alert(uploadTabName);
			$uploadTabs.find('li').removeClass("active");			
			$(this).parent('li').addClass("active");
			$('.tab-paneJS').fadeOut(20);
			$(uploadTabName).fadeIn(10);
		});







		
		
		/* modal - Edit mine it - InitEdit
		-------------*/								
		$(".edit_mine_it").live('click',function()
		{
			//centerPopup(".modal-edit");
			s = $(this).attr("data-id");
			var title_name = "Edit";
			if ( $(this).find("span").attr("tid")== LOAD_MSG_MINED ) {	
				title_name = LOAD_MSG_MINED;
			}
		    $('.modal-edit').find('h2').html(title_name);			
			// image							
			var current_cover       = $("#gmi"+s).attr('tid');
			if (  typeof(current_cover)=="undefined" ) {
				var undefined_html = $("#a_class"+s).html();
				$(".image-edit").html(undefined_html);
			}			
			else{
				//var current_cover_split = current_cover.split('.');
				//var create_post_cover   = current_cover_split[0]+'_m.'+current_cover_split[1];			
				//$(".load_create_post_image").attr('src', create_post_cover);
				//$(".load_create_post_image").attr('alt', current_cover);
				$(".image-edit").html('<img src="'+current_cover+'" class="load_create_post_image" alt="'+current_cover+'">');
				
			}			
			// info
			var newCategory =  $(this).find('span').attr("data-id");
			$(".CurrentBoardEdit").html(newCategory);	
			var create_post_info = $("#load_post_info"+s).html();		
			$(".info-edit").html(create_post_info);				
			$('.create_post_description').focus();
			// insert
			$(".create_post_button").attr('data-id', s);
			$(".create_post_button").attr('tid', "Edit");
			
			$(".delete_post_button").attr('data-id', s);
			var default_des = $("#linktitle"+s).html();
			$(".create_post_description").val(default_des);				
			loadPopup(".modal-edit");			
		});
		
		/* create category */
		$(".create_category_button_edit").live('click',function()
		{
				var newCategory = $(".create_category_name_edit").val();			
				if($.trim(newCategory).length==0)
				{
					return false;
				}	
	
				var ori_text = $('.create_category_button_edit').val();
				$('.create_category_button_edit').val(ori_text+"...");   
				var dataString = 'newCategory='+newCategory;
				$.ajax({
					type: "GET",
					url: "createnewcat.php",
					data: dataString,
					cache: false,
					success: function(data)
					{
						$(".CurrentBoardEdit").html(newCategory);							
						$(".wrapper ul").prepend('<li style="background-color:#E6EFC2;"><span>'+newCategory+'</span></li>');						
						$('.create_category_button_edit').val(ori_text);
						$(".create_category_name_edit").val('');											
						$(".BoardList").hide();																
					}
				});															
		}); 		
		
		
		$(".cancel_edit_mine_it").live('click',function()
		{
			$('.switch-trigger').removeClass('on'); 
			$('.switch-trigger').addClass('off');
			$('.type_1JS').removeAttr('checked'); 	
			$('.create_post_description').val('');	
		    $(".BoardList").hide();				
			disablePopup(".modal-edit");
		});
		
		$(document).keypress(function(e)
		{
			if(e.keyCode==27)
			{
				disablePopup(".modal-edit");
			}
		});	
		
		/* create eidt-mine-it link */
		$(".create_post_button").live('click',function()	{	
			
				IDD = $(this).attr("data-id");
				IDfrom  = $(this).attr("tid");
				var IDint            = $('.CurrentBoardEdit').html();

				//$('.repost_category').html(IDint);	
				if(IDint=="Select a List")
				{
					$(".mainerror_list").html('Please select a new list.');
					$(".mainerror_list").fadeIn('slow');		
					return false;
				}				
				if($.trim(IDint).length==0)
				{
					$(".mainerror_list").html('Please select a new list.');
					$(".mainerror_list").fadeIn('slow');		
					return false;
				}			
						
				if (IDfrom=="Edit") {
				//if ( $('#MineItAction'+s).hasClass("greencolor")) {
					
					//var IDint = $('.CurrentBoardEdit').html();
					//$('.repost_category').html(IDint);					
					var create_post_des = $('.create_post_description').val();			
					if ($('.create_edit_check').attr('checked')=="checked") {
						locked_state = 1;
					}	
					else {
						locked_state = 0;			
					}			
					var ori_text = $('.create_post_button').val();						
					$('.create_post_button').val(ori_text+"...");   										
					var dataString5 = 'profileitemId='+IDD+'&local_idx='+local_id+'&cat_name='+IDint+'&create_post_des='+create_post_des+'&locked='+locked_state+'&from_home='+3;
					$.ajax({
						type: "POST",
						url: "collectlink.php",
						data: dataString5,
						cache: false,
						success: function(data)
						{
							// ***Reset post-form*** //	
							$('.modal-edit').fadeOut(50);					
							$('.switch-trigger').removeClass('on'); 
							$('.switch-trigger').addClass('off');
							$('.type_1JS').removeAttr('checked'); 	
							$('.create_post_description').val('');	
							$('.create_post_button').val(ori_text);					
		    				$(".BoardList").hide();
							$(".mainerror_list").html('');
							$(".mainerror_list").hide();			    			
		    				// ***Show modal-afterpost*** //
		    				var title_name = $('.modal-edit').find('h2').html();
		    				$('.modal-afteredit').find('h2').html(title_name);	
							$('.afterPostForm').html('Edit to <span class="repost_category" style="color: #221919;">'+IDint+'</span></br>Share with your followers. <span style="color: #221919;">See it now.</span>');	    					    				    			
							$('.modal-afteredit').fadeIn(10);						
		 					setTimeout(function(){ disablePopup(".modal-afteredit");},1000);				
						}
					});					
					
				}
				else {
				//else if ( $('#MineItAction'+s).hasClass("bluecolor") ) {		
					
					
					var create_post_des = $('.create_post_description').val();			
					if ($('.create_edit_check').attr('checked')=="checked") {
						locked_state = 1;
					}	
					else {
						locked_state = 0;			
					}			
					var ori_text = $('.create_post_button').val();						
					$('.create_post_button').val(ori_text+"...");   				
					var dataString5 = 'profileitemId='+IDD+'&local_idx='+local_id+'&cat_name='+IDint+'&create_post_des='+create_post_des+'&locked='+locked_state+'&from_home='+1;
					$.ajax({
						type: "POST",
						url: "collectlink.php",
						data: dataString5,
						cache: false,
						success: function(html)
						{
							/* Reset post-form */	
							$('.modal-edit').fadeOut(50);					
							$('.switch-trigger').removeClass('on'); 
							$('.switch-trigger').addClass('off');
							$('.type_1JS').removeAttr('checked'); 	
							$('.create_post_description').val('');	
							$('.create_post_button').val(ori_text);					
		    				$(".BoardList").hide();
							$(".mainerror_list").html('');
							$(".mainerror_list").hide();			    			
		    				/* Show modal-afterpost */
		    				var title_name = $('.modal-edit').find('h2').html();
		    				$('.modal-afteredit').find('h2').html(title_name);
							$('.afterPostForm').html('Edit to <span class="repost_category" style="color: #221919;">'+IDint+'</span></br>Share with your followers. <span style="color: #221919;">See it now.</span>');	    					    					    			
							$('.modal-afteredit').fadeIn(10);
										
							if (IDfrom==1) {						
								/* container add one box  */
								$('html, body').animate({scrollTop:0}, 'slow');
		 						setTimeout(function(){ disablePopup(".modal-afteredit");},1000);
		 						setTimeout(function(){ 
		 						var $container = $('#container');
  				  				var $newEls_prepend = $( html );
    			    			$container.prepend( $newEls_prepend ).isotope('reloadItems').isotope({ sortBy: 'original-order' });
								},1010);     
      			 				setTimeout(function(){ 
   									var $container = $('#container');
    								$container.imagesLoaded( function(){
    	  							$container.isotope({
    	   								 itemSelector : '.photo'
    	 							 });
    								});       
    	    			    		$container.isotope('reLayout');
    							},1610); 
    						}	
    			   			return false;		 								
						}
					});	
									
				}
										
		});	
		
		$('.cancel_afterpost_button').live("click",function() 
		{	
			disablePopup(".modal-afteredit");					 			
		});			
		
		
		
		
		

		$('.delete_post_button').live("click",function(e) 
		{	

			e.preventDefault();
			$('.delete_post_button').unbind('click');	
			var s = $(this).attr('data-id');
				if (confirm("Delete this link you Mine'd , there is no undo.")) {
	
					disablePopup(".modal-edit");
					$('#item'+s).addClass('red_color_border');
					var dataString5 = 'itemId='+s;
					$.ajax({
						url: "deletelink.php?"+dataString5,
						cache: false,
						success: function(html)
						{   	
								$('#item'+s).fadeOut('slow');
								$('#item'+s).remove();
								var $container = $('#container');
								$container.isotope('reLayout');	 		
									return false;		
						}
					});
				}
				else {
		
						return false; 	
				}				
		});	

































		/* Modal - Add - InitAdd
		-------------*/		
		$(".add_button").live('click',function()
		{
			//centerPopup(".modal-add");
			$('.modal-addSelect').fadeOut(10);
			loadPopup(".modal-add");
		});

		
		$(document).keypress(function(e)
		{
			if(e.keyCode==27)
			{
				disablePopup(".modal-add");
			}
		});	
		
		
		
	    /* choose a image */
		$('.gmi-demo').live("click",function() 
		{
			ss = $(this).attr("tid");
			
			ori = $(this).attr("src");			
				
			if (ss==1) {
				k = doc_root+'image.php/image-name.jpg?width=170&amp;image=/'+directory+ori;
				$('#modal_add_load_cover'+ss).html("<img id='gmi1' src='"+k+"' name='"+ori+"'>");	
			} else if (ss==2){
				k = doc_root+'image.php/image-name.jpg?width=85&amp;image=/'+directory+ori;	
				//$('#modal_add_load_cover'+s).html("<img id='gmi2' src='"+k+"' name='"+ori+"'>");	
				$('#modal_add_load_cover1').append("<img id='gmi2' src='"+k+"' name='"+ori+"'>");
				var IDCompare = 1;
				$(".create_add_button").attr('tid',IDCompare);						
			}
			
			$('.modal-choose').fadeOut(100);
			$('.images-choose').html('');						 			
		});			
		
		
			
		/* create new link */ /* cf. collect this link */				
		$(".create_add_button").live('click',function()
		{		
				
				if ($(this).hasClass('disabled')) {
					return false;				
				}

			
				// From Mine it button or Add it button
				var IDfrom           = $(this).attr("data-id");
				var IDCompare        = $(this).attr("tid");		 		
				 

				
				var params, urlArray=[], domainNameArray=[], urldescriptionArray=[], urltitleArray=[], img1srcArray=[];
					
			
			
				// FIXED					
				var IDint            = $('.CurrentBoardAdd').html();
				var w                = $(".create_add_description").val();																											
				if ($('.create_add_check').attr('checked')=="checked") {
					locked_state = 1;
				}	
				else {
					locked_state = 0;			
				}			
			
	
				
				// DEPENDS
				var z                = $("#url1").val();
				z =  z.replace("s://","://").replace("://","://"); 			
				var domainName       = $("#linkTitlePrivate1").val();
				var urldescription   = $("#load_create_post_description1").html();
				var urltitle         = $("#load_create_post_title1").html();											
				var img1src;	


				if (IDfrom==1) {//add it 1 link
					img1src          = $('#gmi1').attr('name');	
				}
				else if (IDfrom==1110) {// mine it 1 link
					var PickIdx      = $("#cur_image").val();
					img1src          = $('#gmi'+PickIdx).find('img').attr('src');
					if ( $(this).attr("name") == "www.youtube.com" ) {
						//alert($(this).attr("name"));
						//youtubeFetchData(z);
						
					}	 								
				}
				img1src              = escape(img1src);	
				

				
				if (IDCompare==1) {//add it 2 link
				var z2               = $("#url2").val();	
				z2 =  z2.replace("s://","://").replace("://","://"); 		
				var domainName2      = $("#linkTitlePrivate2").val();	
				var urldescription2  = $("#load_create_post_description2").html();
				var urltitle2        = $("#load_create_post_title2").html();	
				var img2src;
				img2src          	 = $('#gmi2').attr('name');	
				img2src          	 = escape(img2src);																																
				}			


				params = {
					IDCompare : IDCompare,
					category : IDint,
					describe : w,
					locked : locked_state
				};	
				
				

			$('.info-add').find('.load_create_post_title').each(function(){
				var $b = $(this); 
				if ($b.html()) {
					urltitleArray.push($b.html());				
				} 
			});
			$('.info-add').find('.load_create_post_description').each(function(){
				var $b = $(this); 
				if ($b.html()) {
					urldescriptionArray.push($b.html());				
				} 
			});		
			$('.info-add').find('input').each(function(){
				var $b = $(this); 
				if ($b.attr('value')) {
					urlArray.push($b.attr('value'));				
				} 
			});				
			$('.InputArea').find('input').each(function(){
				var $b = $(this); 
				if ($b.attr('value')) {
					domainNameArray.push($b.attr('value'));				
				} 
			});				
			$('.images-add').find('img').each(function(){
				var $b = $(this); 
				if ($b.attr('name')) {
					img1srcArray.push(escape($b.attr('name')));				
				} 
			});				
									
				//if (IDCompare==0) {				
					//urlArray.push(z);
					//domainNameArray.push(domainName);
					//urldescriptionArray.push(urldescription);								
					//urltitleArray.push(urltitle);				
					//img1srcArray.push(img1src);
				//} else if (IDCompare==1) {
					//urlArray.push(z,z2);
					//domainNameArray.push(domainName,domainName2);
					//urldescriptionArray.push(urldescription,urldescription2);								
					//urltitleArray.push(urltitle,urltitle2);				
					//img1srcArray.push(img1src,img1src2);				
				//}
				params.urlArray = urlArray.join(',');
				params.domainNameArray  = domainNameArray.join(',');				
				
				params.urldescriptionArray =urldescriptionArray.join(','); 
				params.urltitleArray = urltitleArray.join(',');
				params.img1srcArray	= img1srcArray.join(',');			

				
				//alert(params.img1srcArray);					

				if (IDfrom==1) {
					
					$('.repost_category').html(IDint);	
					if(IDint=="Select a List")
					{
						$(".mainerror_list").html('Please select a new list.');
						$(".mainerror_list").fadeIn('slow');		
						return false;
					}				
					if($.trim(IDint).length==0)
					{
						$(".mainerror_list").html('Please select a new list.');
						$(".mainerror_list").fadeIn('slow');		
						return false;
					}	
								
                	
			    	
					if (z.match('^https://')) {
						z		         = z.replace(/^https:\/\//i, 'http://');
					}
					if (z == "http://") {
						alert('Please enter a valid url.');	
						return false;						
					}
					if($.trim(z).length==0)
					{
						alert("Please enter new link again.");
						return false;
					}				
					
				}
  															
				//var dataString       = 'titlePrivate='+domainName+'&describe='+w+'&category='+IDint+'&website='+escape(z)+'&urltitle='+urltitle+'&urldescription='+urldescription+'&locked='+locked_state+'&img1src='+img1src+'&IDCompare='+IDCompare;							
		

				//if (IDCompare==1) {
				//var dataString       = 'titlePrivate='+domainName+'&describe='+w+'&category='+IDint+'&website='+escape(z)+'&urltitle='+urltitle+'&urldescription='+urldescription+'&locked='+locked_state+'&img1src='+img1src+'&IDCompare='+IDCompare+'titlePrivate2='+domainName2+'&website2='+escape(z2)+'&urltitle2='+urltitle2+'&urldescription2='+urldescription2+'&img2src='+img2src;						
				//}			

				// Button
				var ori_text = $('.create_add_button').val();							
				$('.create_add_button').val(ori_text+"..."); 
				$('#loadingGeneral').fadeIn(10);	
				$(this).addClass('disabled'); 						
												
				$.ajax({
					type : 'post',
					url  : 'createnewlink.php',
					data :  {datastring:params},
					cache: false,				
					success: function(html)
					{
		 				if (IDfrom==1) {			
		 						$('#loadingGeneral').fadeOut(10);						

								/* Reset post-form */	
								$('.modal-add').fadeOut(50);					
								$('.switch-trigger').removeClass('on'); 
								$('.switch-trigger').addClass('off');
								$('.type_1JS').removeAttr('checked'); 	
								$('.create_add_description').val('');	
								$('.create_add_button').val(ori_text);					
		    					$(".BoardList").hide();
		    					$('#url1').val('') ;
		    					$('#url2').val('') ;
		    					$('.images-add').html('');
		    					$('.info-add').html('');			    					
								$(".mainerror_list").html('');
								$(".mainerror_list").hide();			    				    			
		    					/* Show modal-afterpost */
		    					var title_name = $('.modal-add').find('h2').html();
		    					$('.modal-afteredit').find('h2').html(title_name);
								$('.afterPostForm').html('Edit to <span class="repost_category" style="color: #221919;">'+IDint+'</span></br>Share with your followers. <span style="color: #221919;">See it now.</span>');	    					    			
								$('.modal-afteredit').fadeIn(10);
								$('html, body').animate({scrollTop:0}, 'slow');
		 						setTimeout(function(){ disablePopup(".modal-afteredit");},1000);
								$(".create_add_button").removeClass('disabled'); 		 				    			 				         	
                            	
		 						/* container add one box  */		 	
		 						setTimeout(function(){ 
		 						var $container = $('#container');
  			  					var $newEls_prepend = $( html );
    		    				$container.prepend( $newEls_prepend ).isotope('reloadItems').isotope({ sortBy: 'original-order' });
								},1010);     
      		 					setTimeout(function(){ 
   									var $container = $('#container');
    								$container.imagesLoaded( function(){
    	  							$container.isotope({
    	   								 itemSelector : '.photo'
    	 							 });
    								});       
    	    		    			$container.isotope('reLayout');
    							},1610);
    				 
    					}
    					else if (IDfrom==1110) {
    									
							$('#f-main2').fadeIn(10);							  
		    				$('#images-add').remove();
		    				$('.PostFormPostthisJS').remove();
		    				$('.edit_add_button').remove();
		    				$('.create_add_button').remove();			    					
                                                  
                                                  
        					//tf_check_hash.stop();
        					var p = window.parent;        	
        					
        									
        					var c_url = $('#url1').val();
        					
        					
        					var json_over_url = encodeURIComponent(JSON.stringify({iframe_height: 162, location_url:c_url}));
        					$('#loadingGeneral').fadeOut(10);			        
        					//alert(json_over_url);        
        					//alert(c_url);
        					try {
        					    p.location.replace(c_url + "#tfbml-data"+json_over_url);
        					} catch (e1) {
        					    p.location = c_url + "#tfbml-data"+json_over_url
        					}
							//return false;
							$(".create_add_button").removeClass('disabled'); 

							setTimeout(function(){ 
								$('a.mine_it_close').click();
							},2200);
		    											  						
    					}
    					
    					
$(".create_add_button").removeClass('disabled'); 
    		   			return false;	
    		   				 												
					}
				});// ajax
					
								
		});	

		/* create category */
		$(".create_category_button_add").live('click',function()
		{
				var newCategory = $(".create_category_name_add").val();			
				if($.trim(newCategory).length==0)
				{
					return false;
				}	
 	
				var ori_text = $('.create_category_button_add').val();							
				$('.create_category_button_add').val(ori_text+"...");  
				
				var dataString = 'newCategory='+newCategory;
				$.ajax({
					type: "GET",
					url: "createnewcat.php",
					data: dataString,
					cache: false,
					success: function(data)
					{
						$(".CurrentBoardAdd").html(newCategory);						
						$(".wrapper ul").prepend('<li style="background-color:#E6EFC2;"><span>'+newCategory+'</span></li>');						
						$('.create_category_button_add').val(ori_text);
						$(".create_category_name_add").val('');											
						$(".BoardList").hide();																
					}
				});															
		}); 
		
		$('.cancel_add_button').live("click",function() 
		{
			$('.switch-trigger').removeClass('on'); 
			$('.switch-trigger').addClass('off');
			$('.type_1JS').removeAttr('checked'); 	
			$('.create_add_description').val('');	
		    $(".BoardList").hide();			
		    $('#url1').val('') ;
		    $('#url2').val('') ;
		    $('.images-add').html('');
		    $('.info-add').html('');
		    $("#modal-add-content").hide();  	
			disablePopup(".modal-add");							 			
		});	
		
		$('.cancel_choose_button').live("click",function() 
		{
			$('.modal-choose').fadeOut(10);			 			
		});			
		
		/* create add link */
		
		
			
		/* fetch text and image */
		//$('#url').bind('input propertychange', function() {
		$('.urlJS').bind('input propertychange', function() {	
			ss = $(this).attr("data-id");
			ss = parseInt(ss.match(/[0-9.]+/g));


			var url_value = $(this).val();
            url_value =  url_value.replace("s://","://").replace("://","://"); 




			if(!isValidURL( url_value ) )
			{
				return false;
			}
			else
			{							
				var getTitle = getDomain( url_value ); 

				$("#create_add_description"+ss).val(getTitle);
				$("#linkTitlePrivate"+ss).val(getTitle);						
				$("#modal_add_load_indicator"+ss).fadeIn('slow');


				var realTitle = url_value;
				

				/* video */									
				if ( (getTitle == "www.youtube.com" || getTitle == "vimeo.com" || getTitle == "www.metacafe.com" || getTitle == "video.google.com" || getTitle == "www.megavideo.com" || getTitle == "www.dailymotion.com" ) && !(realTitle == "http://www.youtube.com" || realTitle == "http://vimeo.com" || realTitle == "http://www.metacafe.com" || realTitle == "http://video.google.com" || realTitle == "http://www.megavideo.com" || realTitle == "http://www.dailymotion.com" )  )
				{									
					/* youtube*/
					if (getTitle == "www.youtube.com" ){
						youtubeFetchData(url_value);
						$("#modal_add_load_indicator"+ss).hide();
						$(".urlJS").blur();
						$("#create_add_description"+ss).focus();									
						$("#modal-add-content").slideDown(500);  							
					}

					/* vimeo */
					else if (getTitle == "vimeo.com" ){
						vimeoLoadingThumb(url_value);
						$("#modal_add_load_indicator"+ss).hide();
						$(".urlJS").blur();
						$("#create_add_description"+ss).focus();									
						$("#modal-add-content").slideDown(500);  							
					}		
	
					/* others video */
					else {

					
						/* iframe part */					
						$.post("fetch_video.php?url="+escape(url_value), {
						}, function(response){
							$('.images-add').html(response);												
						});									
						$.post("fetch_title.php?url="+escape(url_value)+"&titleP="+getTitle, {
						}, function(respond){
							if ($.trim(respond).length > 0) {
								$(".info-add").html(respond);
								$("#modal_add_load_indicator"+ss).hide();
								$("#create_add_description"+ss).focus();
								$("#modal-add-content").slideDown(500);												
							}
						});	

					}
												
				}		
				/* not video */							
				else {			
					/* text part */																	
					$.post("fetch_allworwide.php?url="+escape(url_value)+"&domain="+getTitle+'&number='+ss, {
					}, function(response){
							if (ss==1) {
								$('.info-add').html(response);													
							}
							else if (ss==2) {
								$('.info-add').append(response);	
							}
					});
					/* image part*/
					$.post("fetch_image_allworwide.php?url="+escape(url_value)+'&number='+ss, {
					}, function(response){
							var emptyhtml = $.trim(response).length;
							if (emptyhtml > 0) {
								 
								$('.images-choose').html('');	
								$('.images-choose').html(response);	
								
									
								if (ss==1) { 						
									$('.images-add').html('<div class="modal_add_load_cover" id="modal_add_load_cover1" style="text-align:center;height:170px;display:inline;"></div>');
								} else if (ss==2) {
									
									var ori1 = $('#modal_add_load_cover1').find('img').attr('name');
									k1 = doc_root+'image.php/image-name.jpg?width=85&image=/'+directory+ori1;
									$('#modal_add_load_cover1').find('img').attr('src',k1);										

									//$('#modal_add_load_cover1').append('<img src='' id=''>');
									//$('#modal_add_load_cover1').css('width','85');
									//$('.images-add').append('<div class="modal_add_load_cover" id="modal_add_load_cover2" style="text-align:center;height:170px;display:inline;"></div>');
								}							
						
								$("#modal_add_load_indicator"+ss).hide();
								
								
								if (ss==1) {
									$("#modal-add-content").slideDown(500);
								}
								$('.modal-choose').fadeIn(10);	
							}
							else {
								$('.images-add').hide();
								$("#modal_add_load_indicator"+ss).hide();
								if (ss==1) {
									$("#modal-add-content").slideDown(500);
								}								
							}										
					});					
				}
				
					
			}		
		});		
















		/* COMPARE */
		$('.compare_post_button').live("click",function() 
		{
			$('.InputAreaOne2').toggle("slow");
		});













		/* Modal add like- MineIt Button - InitMineIt
		-------------*/
		$('.edit_add_button').live("click",function() 
		{
			$('.edit_area').toggle("slow");
		});


		/* Choose one image */
		//$('#next').livequery("click", function(){
		$('#next').live("click",function() {			
			

			var firstimage_Ad = $('#cur_image').val();		
			firstimage_Ad = parseInt(firstimage_Ad);
			var totalimgs= $('#total_images').val();
		
			if( firstimage_Ad < totalimgs )
			{				

				
				$('div#gmi'+firstimage_Ad).hide();
				//$('img#gmi'+firstimage_Ad).hide();				
				firstimage_Ad = parseInt(firstimage_Ad)+parseInt(1);
				$('#cur_image').val(firstimage_Ad);
				$('#cur_imag_val').html(firstimage_Ad);	
				//$('img#gmi'+firstimage_Ad).show();
				$('div#gmi'+firstimage_Ad).show();				
						
			}						
		});	
		//$('#prev').livequery("click", function(){
		$('#prev').live("click",function() {			
			var firstimage_Ad2 = $('#cur_image').val();	
			firstimage_Ad2 = parseInt(firstimage_Ad2);
			var totalimgs2= $('#total_images').val();
			totalimgs2 = parseInt(totalimgs2);			
			if( firstimage_Ad2 > 1 && firstimage_Ad2 <= totalimgs2 )
			{
				$('div#gmi'+firstimage_Ad2).hide();				
				//$('img#gmi'+firstimage_Ad2).hide();				
				firstimage_Ad2 = parseInt(firstimage_Ad2)-parseInt(1);
				$('#cur_image').val(firstimage_Ad2);				
				$('#cur_imag_val').html(firstimage_Ad2);					
				//$('img#gmi'+firstimage_Ad2).show();
				$('div#gmi'+firstimage_Ad2).show();										
			}			
		});	

		

		$('.img-pick-thumb').live("click",function() {
			
			//var container_html = $('#MineItImageContainer').html();
			//$('#MineItImageContainer').find('div').css('display','block');
			//var container = "<div style='position: fixed;top: 10px;right: 300px;z-index:99999999;'>"+container_html+"</div>";
			//document.body.append(container);		
			//alert("555");
			//$('#porn_iframe').css('width','837px');
			//$('#porn_iframe').css('height','');			
		});	







		/* Modal - addSelect - InitaddSelect
		-------------*/
		$(".addSelect_button").live('click',function()
		{
			//centerPopup(".modal-add");
			loadPopup(".modal-addSelect");
		});
		
		$(".cancel_addSelect_button").live('click',function()
		{
			disablePopup(".modal-addSelect");
		});
		
		$(document).keypress(function(e)
		{
			if(e.keyCode==27)
			{
				disablePopup(".modal-addSelect");
			}
		});	










		/* Modal - login - Initlogin
		-------------*/
		$(".trigger_modal_login").live('click',function(e)
		{

			e.preventDefault();
			$(".backgroundPopup").css("background-color","#1A1A1A");
			$(".backgroundPopup").addClass("enable_cancel");
			loadPopup(".modal-login");
		});
		

		$(".cancel_login_it, .backgroundPopup").live('click',function()   		
		{
		    if ($(this).hasClass('enable_cancel')) {
				disablePopup(".modal-login");
			$(".backgroundPopup").removeClass("enable_cancel");				
				$(".backgroundPopup").css("background-color","white");
			}
			else {
				return false;
				
			}				
		});
		
		$(document).keypress(function(e)
		{
			if(e.keyCode==27)
			{
				disablePopup(".modal-login");
			}
		});















		/* modal - list  - InitList
		-------------*/								
		$(".add_list").live('click',function() 
		{
			//centerPopup(".modal-edit");
			s = $(this).attr("data-id");

			$('.modal-addSelect').fadeOut(10);							
			loadPopup(".modal-list");			
		});

		$(".cancel_add_list").live('click',function()
		{			
			disablePopup(".modal-list");
			$(".mainerror_list").html('');
			$(".mainerror_list").hide();
			$('.switch-trigger').removeClass('on'); 
			$('.switch-trigger').addClass('off');
			$('.type_1JS').removeAttr('checked'); 
			$('.create_category_name_list').val('');					
			$('.create_list_description').val('');				
		   $(".BoardList").hide();
		    			
		   $("#create_list_name").val('');
		   $("#create_list_tag").val('');	
		   $('.tag').removeClass('selected');
		   				$(".PostForm-list").fadeOut('10');			   	   
		   					
		});



		$('.create_list_description').bind('input propertychange', function() {
				$(".modal_add_load_indicator").hide();
				$(".PostForm-list").fadeIn('50');				
				
		});		
		
		$('.tag').click(function() 
		{

			if ($(this).hasClass('selected')) {
				$(this).removeClass('selected');
				$('#create_list_tag').val('');	
			}
			else {	
				var arr = $('#create_list_tag').val();
				if (arr) {
					alert('Sorry, only ont tag is provided now.');
					//$('#create_list_tag').val(arr+'_'+$(this).html());
					return false;
				}
				else {
					$('#create_list_tag').val($(this).html());				
				}
				$(this).toggleClass('selected');
			}			
		});

		/* create category
		$(".create_category_button_list").live('click',function()
		{
				var newCategory = $(".create_category_name_list").val();			
				if($.trim(newCategory).length==0)
				{
					return false;
				}	
				var ori_text = $('.create_category_button_list').val();
				$('.create_category_button_list').val(ori_text+"...");   	
				
				
				$(".CurrentBoardList").html(newCategory);
				$(".wrapper ul").prepend('<li style="background-color:#E6EFC2;"><span class="new_list">'+newCategory+'</span></li>');						
				$('.create_category_button_list').val(ori_text);
				$(".create_category_name_list").val('');											
				$(".BoardList").hide();					
																
		}); 
		 */
		/* create new list */				
		$(".create_list_button").live('click',function()
		{		
			
				var newCategory = $(".create_category_name_list").val();
				if($.trim(newCategory).length==0)
				{
					$(".mainerror_list").html('Please create a new list.');
					$(".mainerror_list").fadeIn('slow');		
					return false;
				}			
				var catDescription                = $(".create_list_description").val();
				if (catDescription == "Describe your list..") {

					$(".mainerror_list").html('Please add some list description.');
					$(".mainerror_list").fadeIn('slow');
					return false;						
				}
				if($.trim(catDescription).length==0)
				{
					$(".mainerror_list").html('Please add some list description.');
					$(".mainerror_list").fadeIn('slow');					
					return false;
				}
				var catTag                = $("#create_list_tag").val();								
				if($.trim(catTag).length==0)
				{
					$(".mainerror_list").html('Please choose a category.');
					$(".mainerror_list").fadeIn('slow');		
					return false;
				}
																																					
				if ($('.create_list_check').attr('checked')=="checked") {
					locked = 1;
				}	
				else {
					locked = 0;			
				}
				
				$('.create_list_button').val("Doing...");															
									
									
									
									
				var dataString = 'newCategory='+newCategory+'&locked='+locked+'&catDescription='+catDescription+'&catTag='+escape(catTag)+'&from_list='+1; 
				$.ajax({
					type: "GET",
					url: "createnewcat.php",
					data: dataString,
					cache: false,
					success: function(html)
					{
						$(".CurrentBoardList").html(newCategory);
						$(".wrapper ul").prepend('<li style="background-color:#E6EFC2;"><span class="new_list">'+newCategory+'</span></li>');						
						
						$(".create_category_name_list").val('');											
						$(".BoardList").hide();							
						/* Reset post-form */	
						$('.modal-list').fadeOut(50);		
						$(".mainerror_list").html('');
						$(".mainerror_list").hide();									
						$('.switch-trigger').removeClass('on'); 
						$('.switch-trigger').addClass('off');
						$('.type_1JS').removeAttr('checked'); 	
						$('.create_list_description').val('');	
						$('.create_list_button').val("Done");					
		    			$(".BoardList").hide();
		    			
		    			$("#create_list_name").val('');
		    			$("#create_list_tag").val('');
		    			$('.tag').removeClass('selected');
		   				$(".PostForm-list").fadeOut('10');			    			
		    			
		    			
		    			/* Show modal-afterpost */
		    			var title_name = $('.modal-list').find('h2').html();
		    			$('.modal-afteredit').find('h2').html(title_name);
						$('.afterPostForm').html('New list <span class="repost_category" style="color: #221919;">'+newCategory+'</span></br>Share with your followers. <span style="color: #221919;">See it now.</span>');	    					    			
						$('.modal-afteredit').fadeIn(10);
						$('html, body').animate({scrollTop:0}, 'slow');
		 				setTimeout(function(){ disablePopup(".modal-afteredit");},1500);	    			
    		   			return false;	  		   								
																				
					}
				});												
		});			
		
		









		/* modal - share  - InitShare
		-------------*/								
		$(".share_mine_it").live('click',function()
		{
			s            = $(this).attr("data-id");
			if (s=="transfer"){
			 	$(".ImagePicker-share").html('');	
				$(".PostForm-share").html('');	
				$('.modal-share').find('h2').html("Transfer");
				$('.modal-share').find('label').html("Transfer to someone"); 
				$('.modal-share').find('.create_share_button').val("Transfer it"); 
				os                   = $(this).attr("tid");
				var transfer_content = $("#stbody"+os).html();	
				$('.modal-share').find('.create_share_button').attr('tid', os);	
				$('.modal-share').find('.PostForm-share').html("<div class='stbodyMsg' id='stbody"+os+"'>"+transfer_content+"</div>");
				$('.modal-share').find('label').html("Transfer to someone");
				$('.modal-share').find('.InputArea').css("margin-top","5px");
				$('.modal-share').find('.PostForm-share').css("margin-left","15px");
				$('.modal-share').find('.PostForm-share').css("width","590px");		
			}
			else if(s=="NewMessage") {
				
			 	$(".ImagePicker-share").html('');	
				$(".PostForm-share").html('');	
				var usermname = $(this).attr("alt");
				var s2         = $(this).attr("tid"); 
				$('.modal-share').find('h2').html("New Message to "+usermname);
				$('.modal-share').find('label').html(""); 
				$('.modal-share').find('.create_share_button').val("Send it"); 	

				if (s2 > 0) {
					var $mine_share = $(".modal-share");
					var $frm  		= $mine_share.find('div.email-frm');
					$add  		= $frm.find('.add');					
					$frm.find('.add').html('');					
					var testdom = '<b class="comment_button_like name" style="display: inline-block; font-size:15px;padding:6px;margin-bottom:5px;" uid="'+s2+'" username="'+usermname+'">'+usermname+'<a  class="btn-del">x</a></b>';
					$(testdom).insertBefore($add);													
				}
			} 
			else {
				// image										
				var current_cover       = $("#gmi"+s).attr('tid');
				if (  typeof(current_cover)=="undefined" ) {
					var undefined_html = $("#a_class"+s).html();
					$(".image-edit").html(undefined_html);
				}			
				else{
					//var current_cover_split = current_cover.split('.');
					//var create_post_cover   = current_cover_split[0]+'_m.'+current_cover_split[1];			
					//$(".load_create_post_image").attr('src', create_post_cover);
					//$(".load_create_post_image").attr('alt', current_cover);
					$(".image-edit").html('<img src="'+current_cover+'" class="load_create_post_image" alt="'+current_cover+'">');
					
				}
				// info
				var create_post_info = $("#load_post_info"+s).html();		
				$(".info-edit").html(create_post_info);				
				$('.create_post_description').focus();						
				// insert
				$(".create_share_button").attr('data-id', s);
				var default_des = $("#linktitle"+s).html();
				$(".create_post_description").val(default_des);	
				var current_url = $("#current_url"+s).val();
				$(".share-link-input").val(current_url); 	
            	
				//var itemwidth  = $("#item"+s).width()+51; 
				var itemheight = $("#item"+s).height()+41; 
				//var doc_root = location.protocol + '//' + location.host + '/';	
				$(".share-embed-input").val('<iframe src="'+doc_root+'embed.php?latest_item_id='+s+'"  allowtransparency="true" frameborder="0" style="width:280px;height:'+itemheight+'px;margin:0 auto;border:0"></iframe>');
			}	
			
			
			var tPosY = 35+$(window).scrollTop();	//"2%";//	
			$('.modal-share').css({position: 'absolute', top: tPosY});
					
			loadPopup(".modal-share");			
		});

		$(".cancel_share_mine_it").live('click',function()
		{			
			disablePopup(".modal-share");
		});




		var $mine_share = $(".modal-share");
		var $frm  		= $mine_share.find('div.email-frm'),
		    $name 		= $frm.find('b.name').remove(),
		    $list 		= $mine_share.find('ul.user-list'),
		    $item 		= $list.find('> li').remove(),
			$add  		= $frm.find('.add'),
			$inp  		= $frm.find('input:text'),
			txt_add 	= $add.text().split('|'),
			timer, prev_val = '';

		$add.text(txt_add[0]);
		$frm.live('click',function(event) {
			
			if ($(event.target).is('span.add,div.email-frm')) {
				$add.hide();
				$inp.show().val('').focus();
				$frm.addClass('red_bolor_border');
				prev_val = '';
				return false;
			}
		});

		$inp
			.blur(function(){
				$frm.removeClass('red_bolor_border');
				$add.show();
				$list.hide();
				$inp.hide().val('');
			})
			.keydown(function(event){
				switch(event.keyCode) {
					case 8: // backspace
						if ($inp.val().length != 0) return true;
						var $names = $frm.find('b.name');
						if ($names.length > 0) $names.eq(-1).remove();
						return false;
					case 9: // tab
					case 13: // enter
					case 32: // space
					case 186: // ';'
					case 188: // ','
						if ($inp.val().indexOf('@') > 0) {
							setTimeout(function(){
								var email = $.trim($inp.val());
								$inp.val('');
								$name.clone()
									.prepend(document.createTextNode(email))
									.attr('email', email)
									.insertBefore($add);

								$add.text(txt_add[1]).click();
							}, 10);
						} else {
							if (event.keyCode == 9 && $list.is(':hidden')) return true;
							$list.trigger('key.enter');
						}
						return false;
					case 38: $list.trigger('key.up'); return false;
					case 40: $list.trigger('key.down'); return false;
				}

				clearTimeout(timer);

				setTimeout(function(){
					var val = $.trim($inp.val());

					if (!val || val == prev_val) return;

					prev_val = val;

					if (val.indexOf('@') >= 0) return $list.hide();

					$list.hide().html('');

					function request() {
						/*
						$.ajax({
							url  : 'load_share_seacrh_people.php',
							success  : function(html) {
								if (val != $.trim($inp.val())) return $list.hide();
								if (html && html.length) {					
									//for(var i=0,c=json.length; i < c; i++) {
									//	$item.clone()
									//		.attr('uid', json[i].id)
									//		.attr('username', json[i].username)
									//		.find('img').attr('src', json[i].image_url).end()
									//		.find('b').text(json[i].name).end()
									//		.find('small').text('@'+json[i].username).end()
									//		.appendTo($list);
									//}               
									
									                               
									$list.html(html);
									$list.show().find('>li:first').addClass('on');
									
									
									
								} else {
									$list.hide();
								}
							}
						});
						
						*/
						
						var dataString = 'val='+$inp.val();
						$.ajax({
							type: "GET",
							url: "load_share_seacrh_people.php",
							data: dataString,
							cache: false,
							success: function(html)
							{
								if (val != $.trim($inp.val())) return $list.hide();
								if (html && html.length) {					
									$list.html(html);
									$list.show().find('>li:first').addClass('on');															
								} else {
									$list.hide();
								}																
							}
						});							
						
						
					}

					timer = setTimeout(request, 0);

				}, 0);
			});

		$list
			.on('key.up key.down', function(event){
				if ($list.is(':hidden')) return false;

				var $items = $list.children('li'), up = (event.namespace=='up'), idx = Math.min(Math.max($items.filter('.on').index()+(up?-1:1),0), $items.length-1);
				var $on = $items.removeClass('on').eq(idx).addClass('on'), bottom;

				if (up) {
					if (this.scrollTop > $on[0].offsetTop) this.scrollTop = $on[0].offsetTop;
				} else {
					bottom = $on[0].offsetTop - this.offsetHeight + $on[0].offsetHeight;
					if (this.scrollTop < bottom) this.scrollTop = bottom;
				}
			})
			.on('key.enter', function(){
				$list.children('li.on').mousedown();
			})
			.delegate('li', 'mousedown', function(){

				var $item = $(this);
//				$name.clone()
//					.prepend(document.createTextNode($item.find('b').text()))
//					.attr('uid', $item.attr('uid'))
//					.attr('username', $item.attr('username'))
//					.insertBefore($add);


				var testdom = '<b class="comment_button_like name" style="display: inline-block; font-size:15px;padding:6px;margin-bottom:5px;" uid="'+$item.attr('uid')+'" username="'+$item.attr('username')+'">'+$item.attr('username')+'<a  class="btn-del">x</a></b>';
				$(testdom).insertBefore($add);


				$add.text(txt_add[1]);
				setTimeout(function(){ $inp.val('');$frm.click(); }, 10);

				$list.hide();
			});



		$mine_share
// 			.on('mousewheel', function(){ return false })
			.on('show', function(event, btn){
				var $this=$(this).show(), $btn=$(btn), tid=$btn.attr('tid'), uname=$mine_share.attr('uname'), iframe_h, embed_code, url, enc_url, tname, enc_tname, img, img_h;

				setTimeout(function(){ $this.addClass('open') }, 0);

				img = $btn.parent().prev('img').get(0);
				if (!img) img = $('.fig-image > img').get(0);
				iframe_h = Math.ceil(454/img.width * img.height) + 105;
				
				enc_url   = encodeURIComponent(url='http://'+location.host+$btn.closest('a').attr('href')+'?ref='+uname);
				enc_tname = encodeURIComponent(tname=$btn.attr('tname'));

				$this.attr({tid:tid,tname:tname,turl:url,ooid:$btn.attr('uid')});

				$this
					.find('.section').css({marginTop:'',marginLeft:''}).end()
					.find('>.popup-bg').one('click',function(){ $this.trigger('hide') }).end()
					.find('.fig-info')
						.find('#share-link-input').val(url).end()
						.find('#share-embed-input').val(embed_code='<iframe src="http://'+location.host+'/embed/'+tid+'?ref='+uname+'" width="480" height="'+iframe_h+'" allowtransparency="true" frameborder="0" style="width:480px;height:'+iframe_h+'px;margin:0 auto;border:0"></iframe>').end()
					.end()
					.find('.share-via')
						.find('a.tw').attr('href', 'http://twitter.com/share?text='+enc_tname+'&url='+enc_url+'&via=thefancy').end()
						.find('a.fb').attr('href', 'http://www.facebook.com/sharer.php?u='+enc_url).end()
						.find('a.gg').attr('href', 'https://plus.google.com/share?url='+enc_url).end()
						.find('a.su').attr('href', 'http://www.stumbleupon.com/submit?url='+enc_url+'&title='+enc_tname).end()
						.find('a.tb').attr('href', 'http://www.tumblr.com/share/link?url='+enc_url+'&name='+enc_tname+'&description='+encodeURIComponent(embed_code)).end()
						.find('a.li').attr('href', 'http://www.linkedin.com/shareArticle?mini=true&url='+enc_url+'&title='+enc_tname+'&source=thefancy.com').end()
						.find('a.vk').attr('href', 'http://vkontakte.ru/share.php?url='+enc_url).end()
						.find('a.wb').attr('href', 'http://service.weibo.com/share/share.php?url='+enc_url+'&appkey=&title='+enc_tname+'&pic='+encodeURIComponent($btn.attr('timage'))).end()
						.find('a.mx')
							.unbind('click')
							.click(function(){
								try { window.open('http://mixi.jp/share.pl?u='+enc_url+'&k=91966ce7669c34754b21555e4ae88eedce498bf0','share','width=632,height=456').focus(); } catch(e){};
								return false;
							})
						.end()
						.find('a.qz').attr('href', 'http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+enc_url).end()
						.find('a.rr').attr('href', 'http://share.renren.com/share/buttonshare.do?link='+enc_url+'&title='+enc_tname).end()
						.find('a.od').attr('href', 'http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=2&st.noresize=on&st._surl='+enc_url).end()
					.end();

				if(tid != $this.data('prev_tid')) $this.find('.thum>img').attr('src', '/_ui/images/common/blank.gif').attr('src', $btn.attr('timage'));
				if($btn.attr('username')) {
					$this.find('p.from').show().text('from '+$btn.attr('username'));
				} else {
					$this.find('p.from').hide();
				}

				$this.data('prev_tid', tid);
			})
			.on('hide', function(){
				var $this = $(this).removeClass('open');
				$frm.find('b.name').remove();
				$list.hide();
				setTimeout(function(){ $this.hide() }, 500);
			})
			.find('.popup-bg')
				.on('mousedown', function(event){
					if (event.target === this) {
						$mine_share.trigger('hide');
						return false;
					}
				})
			.end()
			.find('h3')
				.on('mousedown', function(event){
					var $h3 = $(this), $dlg = $mine_share.find('.section'), mt = parseInt($dlg.css('margin-top')), ml = parseInt($dlg.css('margin-left')), sx = event.clientX, sy = event.clientY;
					$(document)
						.on('mousemove.share', function(event){
							var dx =  event.clientX - sx, dy = event.clientY - sy;
							$dlg.css({marginTop:(mt+dy)+'px',marginLeft:(ml+dx)+'px'});
							return false;
						})
						.on('mouseup.share', function(){
							$(document).unbind('mousemove.share moveup.share');
							return false;
						});
					return false;
				})
			.end()
			.find('.fig-info input:text')
				.on('focus', function(){ var inp=this;setTimeout(function(){ inp.select() }, 100); })
			.end()
			.find('ul.user-list')
				.delegate('li', 'mouseenter', function(){ $(this).addClass('on') })
				.delegate('li', 'mouseleave', function(){ $(this).removeClass('on') })
			.end()
			.delegate('a.btn-del', 'click', function(){
				$(this).parent().remove();
				if ($frm.find('>b.name').length == 0) $add.text(txt_add[0]);
			})
			.find('.btn-close,.btn-cancel').click(function(){ $('#fancy-share').trigger('hide') })
			.end()
			.find('.btn-share')
				.click(function(){
					var $this = $(this), params, emails=[], users=[];

					$this.addClass('disabled').prop('disabled',true);

					params = {
						type : 'nt',
						url  : $mine_share.attr('turl'),
						name : $mine_share.attr('tname'),
						oid  : $mine_share.attr('tid'),
						ooid : $mine_share.attr('ooid'),
						message :$.trim( $mine_share.find('textarea').val())
					};

					$frm.find('>b.name').each(function(){
						var $b = $(this);
						if ($b.attr('email')) {
							emails.push($b.attr('email'));
						} else {
							users.push($b.attr('uid'));
						}
					});

					params.emails = emails.join(',');
					params.users  = users.join(',');

					$.ajax({
						type : 'post',
						url  : '/share-with-someone.json',
						data : params,
						dataType : 'json',
						success  : function(json){
							if(!json) return;
							if(json.status_code) {
								alert('Sent!');
								$mine_share.trigger('hide');
							} else {
								alert(json.message);
							}
						},
						complete : function(){
							$this.removeClass('disabled').prop('disabled',false);
						}
					});
				})
			.end();





		$mine_share
			.find('.create_share_button')
				.live('click',function(){
					
					
					var item_id            = $(this).attr("data-id");
					var msg_id             = $(this).attr("tid");
					var subject            = $(".create_share_description").val();
					if ($.trim(subject).length==0) {
						$(".mainerror_share").html('Please write some message.');
						$(".mainerror_share").fadeIn('slow');
						return false;						
					}					
					var f_ids;
					$frm.find('>b.name').each(function(){
						var $b = $(this);
						if ($b.attr('uid')) {
							if ($.trim(f_ids).length==0) {
								f_ids = $b.attr('uid');
							}
							else {
								f_ids = f_ids + '_' + $b.attr('uid');							
							}
						}
					});					
					
					var ori_text= $('.create_share_button').val();
					$('.create_share_button').val(ori_text+"...");
					var dataString = 'f_ids='+f_ids+'&local_id='+local_id+'&item_id='+item_id+'&subject='+subject+'&profile_id='+msg_id+'&message_id='+2+'&message_html='+'';
					
					
					$.ajax({
						type: "GET",
						url: "createnewmessage.php",
						data: dataString,
						cache: false,
						success: function()
						{

							$('.create_share_button').val(ori_text);																
						}
					});						
					
					
				})
			.end();











		/* infinite scroll - InitInfiniteScroll
		-------------*/						
       	var flag = false;	
		$(window).scroll(function() {	
		
					
		        if  ($(window).scrollTop() >= ( $(document).height()) - $(window).height()) {
		            if (!flag && !pause_load_more) {		
		  				flag = true;          
						var ID33 = $('.more').attr("id");
						var ID555 = $('.more').attr("data-id");

						//$("#infscr-loading").hide();
						//$("#infscr-loading2").hide();	
						//$("#loadingGeneral").hide();
						$(".loadingAllworldwideLinksJS").hide();						
						if(ID33)
						{					
						    $('.morebox').remove();	
							//$("#infscr-loading").show();
							//$("#loadingGeneral").show();		
							$(".loadingAllworldwideLinksJS").show();							
							
							if (ID555==1) {
								
								
								$.ajax({
									type: "POST",
									url: "moreupdates_ajax_worldwide.php",
									data: "lastid="+ID33+"&uid="+local_id, 
									cache: false,
									success: function(html){	
										
										
  		  									var $newEls = $( html );
  		  									var $container = $('#container');
  		  									$container.append( $newEls ).isotope( 'appended', $newEls );	
  		  									
 		  									
  		  									// Init
											$('.comment-worldwide').bind('input propertychange', function() {
												var parentId = $(this).attr('id');	
												var s = 0;
												if(parentId){
													s = parseInt(parentId.match(/[0-9.]+/g));
												}
  												var $container = $('#container');			
        									
    											$("#ctextarea"+s).focus();	
  												$('#commentbutton'+s).fadeIn('slow');
												$container.isotope('reLayout');	     						
												return false;		
											
											});  		  								
  		  									// Init
  											$("iframe").each(function(){
  												    var ifr_source = $(this).attr('src');
  												    var wmode = "wmode=transparent";
  												    if(ifr_source.indexOf('?') != -1) {
  												        var getQString = ifr_source.split('?');
  												        var oldString = getQString[1];
  												        var newString = getQString[0];
  												        $(this).attr('src',newString+'?'+wmode+'&'+oldString);
  												    }
  												    else $(this).attr('src',ifr_source+'?'+wmode);
  											});	
											setTimeout(function(){ 
												$container.isotope('reLayout');
											},1000);	
											setTimeout(function(){ 
												//$("#infscr-loading").hide();
											    //$("#loadingGeneral").hide();	
											    $(".loadingAllworldwideLinksJS").hide();
												flag = false;         
											},1600);						
										 	return false;
									}
								}); 
								
								
							}
							else if (ID555==2) {


								$.ajax({
									type: "POST",
									url: "moreupdates_ajax.php",
									data: "lastid="+ID33+"&uid="+local_id+"&remote_id="+remote_id+"&mined="+mined+"&mostViewed="+mostViewed+"&video="+video+"&viewed="+viewed,  
									cache: false,
									success: function(html){	
											
											
											
											if ($.trim(html).length < 100) {
												//$("#infscr-loading").hide();
												//$("#infscr-loading2").show();	
												//$("#loadingGeneral").show();
												$(".loadingAllworldwideLinksJS").show();									
												setTimeout(function(){ 
													//$("#infscr-loading2").hide();
													//$("#loadingGeneral").hide();
													$(".loadingAllworldwideLinksJS").hide();														
												},700);								
												flag = true;   
									 			return false;														
											}
											
											
											
  		  									var $newEls = $( html );
  		  									var $container = $('#container');
  		  									$container.append( $newEls ).isotope( 'appended', $newEls );	
  		  									
 		  									
  		  									// Init
											$('.comment-worldwide').bind('input propertychange', function() {
												var parentId = $(this).attr('id');	
												var s = 0;
												if(parentId){
													s = parseInt(parentId.match(/[0-9.]+/g));
												}
  												var $container = $('#container');			
        									
    											$("#ctextarea"+s).focus();	
  												$('#commentbutton'+s).fadeIn('slow');
												$container.isotope('reLayout');	     						
												return false;		
											
											});  		  								
  		  									// Init
  											$("iframe").each(function(){
  												    var ifr_source = $(this).attr('src');
  												    var wmode = "wmode=transparent";
  												    if(ifr_source.indexOf('?') != -1) {
  												        var getQString = ifr_source.split('?');
  												        var oldString = getQString[1];
  												        var newString = getQString[0];
  												        $(this).attr('src',newString+'?'+wmode+'&'+oldString);
  												    }
  												    else $(this).attr('src',ifr_source+'?'+wmode);
  											});	
											setTimeout(function(){ 
												$container.isotope('reLayout');
											},1000);	
											setTimeout(function(){ 
												//$("#infscr-loading").hide();
												//$("#loadingGeneral").hide();
												$(".loadingAllworldwideLinksJS").hide();													
												flag = false;         
											},1600);						
										 	return false;
									}
								}); 								
								
								
								
							} // end else if
							
							
							
							
						}
						else
						{
										$("#infscr-loading2").show();	
												$("#loadingGeneral").show();																			
										setTimeout(function(){ 
											$("#infscr-loading2").hide();
												$("#loadingGeneral").hide();		
										},700);								
										flag = true;   
									 	return false;			
						}		
		        	}
		    	}
		});	
   
   
								    															
  });//
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
function isValidURL(url) {
	var RegExp = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;	
	//         "^(http|https|ftp)\://[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(:[a-zA-Z0-9]*)?/?([a-zA-Z0-9\-\._\?\,\'/\\\+&amp;%\$#\=~])*$";	
	if(RegExp.test(url)){
		return true;
	}else{
		return false;
	}
}
function getDomain(url) {
	url=	unescape(url);		
	s = url.match(/(s:|:|%3A)\/\/(www\.)?(.[^/:]+)/g);
	for(var i=0;i<s.length;i++){
	    tempdomain = s[i];
		domainname = tempdomain.replace("s://","").replace("://",""); 
		return domainname;
	}
}    
  
/* init add - fetch vimeo */	  
function getVimeoId( url ) {
  // look for a string with 'vimeo', then whatever, then a forward slash and a group of digits.
  var match = /vimeo.*\/(\d+)/i.exec( url );

  // if the match isn't null (i.e. it matched)
  if ( match ) {
    // the grouped/matched digits from the regex
    return match[1];
  }
}
function vimeoLoadingThumb(urlValue){ 
  	video_link_url = urlValue;
	var id = getVimeoId(urlValue);	  
    $.getScript("http://vimeo.com/api/v2/video/" + id + ".json?callback=showThumb");
}
function showThumb(data){
  	$('.create_add_description').val(data[0].title);   
	$('.images-add').html('<img id="gmi1" src="'+data[0].thumbnail_medium+'" name="'+data[0].thumbnail_medium+'">'); 
  	$('.info-add').html('<div style="border-top: 1px solid #D9D4D4; margin-top:10px;margin-bottom:10px;"></div><img class="load_create_post_favicon" src="'+'http://www.google.com/s2/favicons?domain=vimeo.com'+'" width="18" height="18"  style="border-radius:9px;-moz-border-radius:9px;-webkit-border-radius:9px;-khtml-border-radius:9px; position:relative; top:3px;"><span class="load_create_post_title">'+data[0].title+'</span><div style="margin-top:12px;"></div><input type="hidden" value="'+video_link_url+'"><span class="load_create_post_description">'+data[0].stats_number_of_likes+' favorite(s); '+data[0].stats_number_of_plays+' view(s)...</span>'); 	  
}  
/* init add - fetch youtube */		
function youtubeFetchData(urlValue)
{
  var videoid = '';
  var tempvar = urlValue;	
  video_link_url = urlValue;
  if ( /^https?\:\/\/.+/i.test( tempvar ) )
  {
    tempvar = /[\?\&]v=([^\?\&]+)/.exec( tempvar );
    if ( ! tempvar )
    {
      alert( 'YouTube video URL has a problem!' );
      return;
    }
    videoid = tempvar[ 1 ];
  }
  else
  {
    if ( /^[A-Za-z0-9_\-]{8,32}$/.test( tempvar ) == false )
    {
      alert( 'YouTube video ID has a problem!' );
      return;
    }
    videoid = tempvar;
  }
  $.getScript( 'http://gdata.youtube.com/feeds/api/videos/' + encodeURIComponent( videoid ) + '?v=2&alt=json-in-script&callback=youtubeFetchDataCallback' );
}
function youtubeFetchDataCallback(data)
{
  var s = '';
  var d = '';  
  var i = '';
  var w = '';
  var h = '';    
  var sf = '';
  var sv = '';    
  // s += '<img src="' + data.entry[ "media$group" ][ "media$thumbnail" ][ 0 ].url + '" width="' + data.entry[ "media$group" ][ "media$thumbnail" ][ 0 ].width + '" height="' + data.entry[ "media$group" ][ "media$thumbnail" ][ 0 ].height + '" alt="Default Thumbnail" align="right"/>';
  // s += '<b>Title:</b> ' + data.entry[ "title" ].$t + '<br/>';
  // s += '<b>Author:</b> ' + data.entry[ "author" ][ 0 ].name.$t + '<br/>';
  // s += '<b>Published:</b> ' + new Date( data.entry[ "published" ].$t.substr( 0, 4 ), data.entry[ "published" ].$t.substr( 5, 2 ) - 1, data.entry[ "published" ].$t.substr( 8, 2 ) ).toLocaleDateString( ) + '<br/>';
  // s += '<b>Duration:</b> ' + Math.floor( data.entry[ "media$group" ][ "yt$duration" ].seconds / 60 ) + ':' + ( data.entry[ "media$group" ][ "yt$duration" ].seconds % 60 ) + ' (' + data.entry[ "media$group" ][ "yt$duration" ].seconds + ' seconds)<br/>';
  // s += '<b>Rating:</b> ' + new Number( data.entry[ "gd$rating" ].average ).toFixed( 1 ) + ' out of ' + data.entry[ "gd$rating" ].max + '; ' + data.entry[ "gd$rating" ].numRaters + ' rating(s)' + '<br/>';
  // s += '<b>Statistics:</b> ' + data.entry[ "yt$statistics" ].favoriteCount + ' favorite(s); ' + data.entry[ "yt$statistics" ].viewCount + ' view(s)' + '<br/>';
  // s += '<br/>' + data.entry[ "media$group" ][ "media$description" ].$t.replace( /\n/g, '<br/>' ) + '<br/>';
  // s += '<br/><a href="' + data.entry[ "media$group" ][ "media$player" ].url + '" target="_blank">Watch on YouTube</a>';
  // $( '#youtubeDataFetcherOutput' ).html( s );
  i += data.entry[ "media$group" ][ "media$thumbnail" ][ 0 ].url;
  //w += data.entry[ "media$group" ][ "media$thumbnail" ][ 0 ].width;
  //h += data.entry[ "media$group" ][ "media$thumbnail" ][ 0 ].height;
  s += data.entry[ "title" ].$t;
  d += data.entry[ "media$group" ][ "media$description" ].$t.replace( /\n/g, '<br/>' );
  //$('#linkTitle').val(s);
  sf += data.entry[ "yt$statistics" ].favoriteCount;
  sv += data.entry[ "yt$statistics" ].viewCount;
  $('.create_add_description').val(s);
  $('.images-add').html('<img id="gmi1" src="'+i+'" name="'+i+'">');
  $('.info-add').html('<div style="border-top: 1px solid #D9D4D4; margin-top:10px;margin-bottom:10px;"></div><img class="load_create_post_favicon" src="'+'http://www.google.com/s2/favicons?domain=www.youtube.com'+'" width="18" height="18"  style="border-radius:9px;-moz-border-radius:9px;-webkit-border-radius:9px;-khtml-border-radius:9px; position:relative; top:3px;"><span class="load_create_post_title">'+s+'</span><div style="margin-top:12px;"></div><input type="hidden" value="'+video_link_url+'"><span class="load_create_post_description">'+sf+' favorite(s); '+sv+' view(s)...</span>');           
}  


/* init scroll */
function scrollOnClick(vAmount) 
{
    var currentPos = getScrollXY();
    setScrollXY(currentPos[0], currentPos[1] + vAmount);
}
function getScrollXY() {
  	var scrOfX = 0, scrOfY = 0;
    scrOfY = document.body.scrollTop;
    scrOfX = document.body.scrollLeft;
  	return [ scrOfX, scrOfY ];
}
function setScrollXY(x, y) {	
    $('html, body').animate({scrollTop:y}, 'slow');
}